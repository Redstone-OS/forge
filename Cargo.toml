# =============================================================================
# FORGE KERNEL - Cargo.toml
# =============================================================================
#
# Microkernel Industrial-Grade para Redstone OS
#
# SISTEMA DE LOGS ZERO-OVERHEAD:
# - no_logs:   Release - remove 100% dos logs (custo ZERO no binário)
# - log_info:  Dev - apenas INFO, WARN, ERROR
# - log_trace: Debug - todos os níveis (padrão para desenvolvimento)
#
# Para compilar:
#   cargo build                    # Usa log_trace (padrão)
#   cargo build --features log_info --no-default-features
#   cargo build --features no_logs --no-default-features
#
# =============================================================================

[package]
name = "forge"
version = "0.0.4"
edition = "2021"
authors = ["Redstone OS Team"]
description = "Industrial-Grade Microkernel for Redstone OS"
license = "MIT"

[dependencies]
# Sincronização e Concorrência (Essencial para Mutex/Spinlocks)
spin = "0.9.8"

# Manipulação de bits segura (Essencial para Flags de GDT/Paging)
bitflags = "2.4.2"

# Acesso à memória volátil (Essencial para MMIO/Framebuffer)
volatile = "0.5.1"

# Alocador de Lista Encadeada (Para o Heap futuro - Upgrade do Bump)
linked_list_allocator = "0.10.5"

# =============================================================================
# FEATURES
# =============================================================================

[features]
# ---------------------------------------------------------------------------
# DEFAULT: Modo de desenvolvimento com logs completos
# ---------------------------------------------------------------------------
default = ["log_trace", "self_test"]

# ---------------------------------------------------------------------------
# SISTEMA DE LOGS ZERO-OVERHEAD
# ---------------------------------------------------------------------------
# Estes são MUTUAMENTE EXCLUSIVOS. Use apenas um por vez.
#
# no_logs:   RELEASE - Remove TODOS os logs do binário. Custo ZERO.
#            Os macros kinfo!, kdebug!, etc. viram expressões vazias.
#
# log_info:  DEV - Apenas logs importantes (INFO, WARN, ERROR).
#            DEBUG e TRACE são removidos.
#
# log_trace: DEBUG - Todos os níveis de log ativos.
#            Mais verbose, ideal para debugging profundo.
# ---------------------------------------------------------------------------
no_logs = []
log_info = []
log_trace = []

# ---------------------------------------------------------------------------
# Self Test (Testes de Subsistemas)
# ---------------------------------------------------------------------------
self_test = []

# ---------------------------------------------------------------------------
# SMP (Symmetric Multi-Processing)
# ---------------------------------------------------------------------------
smp = ["tlb_shootdown", "percpu_caches"]
tlb_shootdown = []                       # TLB shootdown via IPI
percpu_caches = []                       # Per-CPU object caches

# ---------------------------------------------------------------------------
# Memops
# ---------------------------------------------------------------------------
memops_asm = [] # Usar implementação ASM (produção)
# Nota: memops_rust é o padrão quando memops_asm não está ativo

# ---------------------------------------------------------------------------
# Segurança
# ---------------------------------------------------------------------------
wx_enforcement = [] # Bloquear mapeamentos RWX (W^X policy)
guard_pages = []    # Guard pages para stacks

# ---------------------------------------------------------------------------
# Accounting
# ---------------------------------------------------------------------------
memory_accounting = [] # Tracking de memória por subsistema

# ---------------------------------------------------------------------------
# Debug avançado
# ---------------------------------------------------------------------------
alloc_stats = [] # Estatísticas de alocação
mm_trace = []    # Trace detalhado do MM

# ---------------------------------------------------------------------------
# NUMA
# ---------------------------------------------------------------------------
numa = [] # NUMA-aware allocation

# =============================================================================
# PROFILES
# =============================================================================

[profile.dev]
panic = "abort"
opt-level = 0
debug = true

[profile.release]
panic = "abort"
opt-level = 3
lto = true
codegen-units = 1
debug = false
strip = true      # Remove símbolos para binário menor
