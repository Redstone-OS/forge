[package]
name = "forge"
version = "0.0.2"                                            # Bump para Reformulação MM
edition = "2021"
authors = ["Redstone OS Team"]
description = "Industrial-Grade Microkernel for Redstone OS"
license = "MIT"

[dependencies]
# Sincronização e Concorrência (Essencial para Mutex/Spinlocks)
spin = "0.9.8"

# Manipulação de bits segura (Essencial para Flags de GDT/Paging)
bitflags = "2.4.2"

# Acesso à memória volátil (Essencial para MMIO/Framebuffer)
volatile = "0.5.1"

# Alocador de Lista Encadeada (Para o Heap futuro - Upgrade do Bump)
linked_list_allocator = "0.10.5"

[features]
default = [
    "serial_debug",
    "verbose_logs",
]

# Debug e Logging
serial_debug = []    # Habilita logs na porta serial
verbose_logs = []    # Habilita DEBUG/TRACE logs (desabilitar em release)

# =============================================================================
# NOVAS FEATURES PARA MM REFORMULADO
# =============================================================================

# SMP (Symmetric Multi-Processing)
smp = ["tlb_shootdown", "percpu_caches"]
tlb_shootdown = []   # TLB shootdown via IPI
percpu_caches = []   # Per-CPU object caches

# Memops
memops_asm = []      # Usar implementação ASM (produção)
# Nota: memops_rust é o padrão quando memops_asm não está ativo

# Segurança
wx_enforcement = []  # Bloquear mapeamentos RWX (W^X policy)
guard_pages = []     # Guard pages para stacks

# Accounting
memory_accounting = [] # Tracking de memória por subsistema

# Debug avançado
alloc_stats = []     # Estatísticas de alocação
mm_trace = []        # Trace detalhado do MM

# NUMA
numa = []            # NUMA-aware allocation

[profile.dev]
panic = "abort"
opt-level = 0
debug = true
# NOTA: debug-assertions habilitado por padrão em dev
# Isso permite que cfg(debug_assertions) funcione para logs verbose

[profile.release]
panic = "abort"
opt-level = 3
lto = true
codegen-units = 1
debug = false
strip = true      # Remove símbolos para binário menor

