//! Font Rendering
//!
//! Provides bitmap font rendering for text display.
//! Uses a simple 8x16 VGA-style font.

use super::framebuffer::{Color, Framebuffer};

/// Font width in pixels
pub const FONT_WIDTH: usize = 8;

/// Font height in pixels
pub const FONT_HEIGHT: usize = 16;

/// Get bitmap for a character
fn get_char_bitmap(c: char) -> &'static [u8; 16] {
    match c {
        // Digits
        '0' => &[
            0x00, 0x00, 0x3C, 0x66, 0x66, 0x6E, 0x76, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '1' => &[
            0x00, 0x00, 0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '2' => &[
            0x00, 0x00, 0x3C, 0x66, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x66, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '3' => &[
            0x00, 0x00, 0x3C, 0x66, 0x06, 0x06, 0x1C, 0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '4' => &[
            0x00, 0x00, 0x0C, 0x1C, 0x3C, 0x6C, 0x6C, 0x7E, 0x0C, 0x0C, 0x0C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '5' => &[
            0x00, 0x00, 0x7E, 0x60, 0x60, 0x7C, 0x06, 0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '6' => &[
            0x00, 0x00, 0x3C, 0x66, 0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '7' => &[
            0x00, 0x00, 0x7E, 0x66, 0x06, 0x0C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '8' => &[
            0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '9' => &[
            0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],

        // Uppercase letters
        'A' | 'a' => &[
            0x00, 0x00, 0x18, 0x3C, 0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'B' | 'b' => &[
            0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'C' | 'c' => &[
            0x00, 0x00, 0x3C, 0x66, 0x60, 0x60, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'D' | 'd' => &[
            0x00, 0x00, 0x78, 0x6C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'E' | 'e' => &[
            0x00, 0x00, 0x7E, 0x60, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'F' | 'f' => &[
            0x00, 0x00, 0x7E, 0x60, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'G' | 'g' => &[
            0x00, 0x00, 0x3C, 0x66, 0x60, 0x60, 0x6E, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'H' | 'h' => &[
            0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'I' | 'i' => &[
            0x00, 0x00, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'J' | 'j' => &[
            0x00, 0x00, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'K' | 'k' => &[
            0x00, 0x00, 0x66, 0x6C, 0x78, 0x70, 0x70, 0x78, 0x6C, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'L' | 'l' => &[
            0x00, 0x00, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'M' | 'm' => &[
            0x00, 0x00, 0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'N' | 'n' => &[
            0x00, 0x00, 0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'O' | 'o' => &[
            0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'P' | 'p' => &[
            0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x60, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'Q' | 'q' => &[
            0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x6C, 0x36, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'R' | 'r' => &[
            0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'S' | 's' => &[
            0x00, 0x00, 0x3C, 0x66, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'T' | 't' => &[
            0x00, 0x00, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'U' | 'u' => &[
            0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'V' | 'v' => &[
            0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'W' | 'w' => &[
            0x00, 0x00, 0x63, 0x63, 0x63, 0x63, 0x6B, 0x7F, 0x77, 0x63, 0x63, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'X' | 'x' => &[
            0x00, 0x00, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x3C, 0x66, 0x66, 0x66, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'Y' | 'y' => &[
            0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        'Z' | 'z' => &[
            0x00, 0x00, 0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x60, 0x60, 0x7E, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],

        // Special characters
        ' ' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '!' => &[
            0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00,
            0x00, 0x00,
        ],
        '.' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00,
            0x00, 0x00,
        ],
        ',' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30, 0x00,
            0x00, 0x00,
        ],
        ':' => &[
            0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '/' => &[
            0x00, 0x00, 0x06, 0x06, 0x0C, 0x0C, 0x18, 0x18, 0x30, 0x30, 0x60, 0x60, 0x00, 0x00,
            0x00, 0x00,
        ],
        '-' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '_' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00,
            0x00, 0x00,
        ],
        '=' => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '+' => &[
            0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '(' => &[
            0x00, 0x00, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        ')' => &[
            0x00, 0x00, 0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        '[' => &[
            0x00, 0x00, 0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
        ']' => &[
            0x00, 0x00, 0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],

        // Default: blank character
        _ => &[
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00,
        ],
    }
}

/// Draw a single character on the framebuffer
///
/// # Arguments
/// * `fb` - Framebuffer to draw on
/// * `x` - X coordinate (top-left)
/// * `y` - Y coordinate (top-left)
/// * `c` - Character to draw
/// * `fg` - Foreground color
/// * `bg` - Background color
pub fn draw_char(fb: &mut Framebuffer, x: usize, y: usize, c: char, fg: Color, bg: Color) {
    let bitmap = get_char_bitmap(c);

    for row in 0..FONT_HEIGHT {
        let byte = bitmap[row];
        for col in 0..FONT_WIDTH {
            let bit = (byte >> (7 - col)) & 1;
            let color = if bit == 1 { fg } else { bg };
            fb.write_pixel(x + col, y + row, color);
        }
    }
}
